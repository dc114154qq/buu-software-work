<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™¯ç‚¹ç¾é£Ÿåˆ—è¡¨</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header><h1>æ™¯ç‚¹ç¾é£Ÿ</h1></header>

    <div class="container">
        <input type="text" class="search-box" placeholder="æœç´¢é¤å…ã€æ™¯ç‚¹..." id="search-input">
        <div id="list-container"></div>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item"><span class="nav-icon">ğŸ </span>é¦–é¡µ</a>
        <a href="pois.html" class="nav-item active"><span class="nav-icon">ğŸœ</span>æ™¯ç‚¹ç¾é£Ÿ</a>
        <a href="stays.html" class="nav-item"><span class="nav-icon">ğŸ›ï¸</span>é…’åº—ä½å®¿</a>
        <a href="route.html" class="nav-item"><span class="nav-icon">ğŸ—ºï¸</span>è·¯çº¿</a>
    </nav>

    <script>
        let allPois = [];
        const container = document.getElementById('list-container');

        // --- æ¸²æŸ“å‡½æ•° ---
        function render(list) {
            container.innerHTML = '';
            if(list.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:20px;color:#999">æš‚æ— ç›¸å…³æ•°æ®</div>';
                return;
            }

            list.forEach(item => {
                const address = item.location ? item.location.address : 'åœ°å€æœªçŸ¥';
                const price = item.avgPricePerPersonCNY ? `Â¥${item.avgPricePerPersonCNY}/äºº` : 'Â¥-';
                
                // ä¿®æ”¹ï¼šç›´æ¥ä½¿ç”¨æœ¬åœ°å›¾ç‰‡è·¯å¾„
                // data.json ä¸­çš„è·¯å¾„é€šå¸¸ä¸º assets/img/...
                let imgSrc = '';
                if (item.media && item.media.cover) {
                    imgSrc = item.media.cover; 
                }

                container.innerHTML += `
                    <a href="detail.html?id=${item.id}" class="card">
                        <div class="card-left">
                            <img src="${imgSrc}" class="thumb-img" onerror="this.style.display='none'">
                        </div>
                        <div class="card-content">
                            <div>
                                <h4 class="card-title">${item.name}</h4>
                                <div class="card-info">â˜… ${item.rating} <span class="tag">${item.category}</span></div>
                                <div class="card-info">ğŸ“ ${address}</div>
                            </div>
                            <div class="price">${price}</div>
                        </div>
                    </a>`;
            });
        }

        // --- åŠ è½½æ•°æ® ---
        fetch('./data.json')
            .then(res => res.json())
            .then(data => {
                allPois = data.pois || [];
                render(allPois);
            })
            .catch(err => {
                console.error(err);
                container.innerHTML = "<p style='text-align:center;margin-top:20px'>æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿ä½¿ç”¨ http.server è¿è¡Œ</p>";
            });

        // æœç´¢åŠŸèƒ½
        document.getElementById('search-input').addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            const filtered = allPois.filter(i => i.name.includes(val) || i.category.includes(val));
            render(filtered);
        });
    </script>
</body>
</html>