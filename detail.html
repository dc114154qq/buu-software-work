<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¦æƒ… - æ¨æ¢…ç«¹æ–œè¡—</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="detail-header">
        <img id="d-img" class="detail-img" src="" alt="æ™¯ç‚¹å›¾ç‰‡" onclick="openModal()" onerror="this.src='https://via.placeholder.com/400x200?text=No+Image';this.style.cursor='default';">
        <div id="d-cover-text" style="position:absolute; bottom:10px; left:15px; color:white; font-size:1.5rem; text-shadow:0 2px 4px rgba(0,0,0,0.5); pointer-events:none;"></div>
    </div>
    
    <div class="detail-body">
        <a href="javascript:history.back()" style="color:var(--primary-color); font-weight:bold; display:block; margin-bottom:15px; text-decoration:none;">
            â† è¿”å›ä¸Šä¸€é¡µ
        </a>
        
        <h2 id="d-name" style="margin-top:0;"></h2>
        <div style="margin-bottom:15px;">
            <span class="tag" id="d-type"></span>
            <span style="color:#ff9f43; font-weight:bold; margin-left:10px;" id="d-rating"></span>
            <span style="color:#636e72; font-size:0.9rem; margin-left:10px;" id="d-price"></span>
        </div>
        
        <p id="d-address" style="color:#666; border-bottom:1px solid #eee; padding-bottom:15px; margin-bottom:15px; display:flex; align-items:center;">
            ğŸ“ <span style="margin-left:5px">åŠ è½½ä¸­...</span>
        </p>
        
        <h4>ğŸ’° ä¼˜æƒ ä¿¡æ¯</h4>
        <div id="d-offers" style="margin-bottom:20px;"></div>

        <h4>ğŸ“ ç®€ä»‹ / è®¾æ–½</h4>
        <div id="d-desc" style="color:#555; font-size:0.9rem; line-height:1.6;"></div>
    </div>

    <div id="imgModal" class="modal" onclick="closeModal()">
        <span class="close-btn">&times;</span>
        <img class="modal-content" id="img01">
    </div>

    <script>
        // è·å–URLå‚æ•°
        const params = new URLSearchParams(window.location.search);
        const targetId = params.get('id');

        fetch('./data.json').then(res => res.json()).then(data => {
            const allItems = [...(data.pois||[]), ...(data.stays||[])];
            const item = allItems.find(i => i.id === targetId);

            if(!item) {
                document.body.innerHTML = "<div style='padding:20px;text-align:center'>âš ï¸ æœªæ‰¾åˆ°è¯¥é¡¹ç›®ä¿¡æ¯</div>";
                return;
            }

            // 1. åŸºç¡€ä¿¡æ¯æ¸²æŸ“ [cite: 194]
            document.getElementById('d-name').innerText = item.name;
            document.getElementById('d-cover-text').innerText = item.name;
            document.getElementById('d-type').innerText = item.category || item.starOrLevel || 'å…¶å®ƒ';
            document.getElementById('d-rating').innerText = item.rating ? `â˜… ${item.rating}` : 'æš‚æ— è¯„åˆ†';
            
            // 2. å›¾ç‰‡å¤„ç†ä¸é”™è¯¯äº¤äº’ [cite: 193, 195]
            const imgEl = document.getElementById('d-img');
            if (item.media && item.media.cover) {
                imgEl.src = item.media.cover; 
            } else {
                // å¦‚æœæ²¡æœ‰å›¾ç‰‡å­—æ®µï¼Œä½¿ç”¨é»˜è®¤å ä½å›¾
                imgEl.src = 'https://via.placeholder.com/400x300?text=No+Image';
                imgEl.onclick = null; // ç¦ç”¨ç‚¹å‡»
                imgEl.style.cursor = 'default';
            }

            // 3. ä»·æ ¼ä¸åœ°å€
            let price = item.avgPricePerPersonCNY;
            if(!price && item.roomOffers && item.roomOffers.length) price = item.roomOffers[0].priceCNY;
            document.getElementById('d-price').innerText = price ? `Â¥${price}èµ·` : '';
            
            const address = item.location ? item.location.address : (item.address || 'åœ°å€æœªçŸ¥');
            document.getElementById('d-address').innerHTML = `ğŸ“ <span style="margin-left:5px">${address}</span>`;

            // 4. ä¼˜æƒ åˆ—è¡¨æ¸²æŸ“
            const offersDiv = document.getElementById('d-offers');
            let html = '';
            if(item.deals && item.deals.length) {
                item.deals.forEach(d => {
                    html += `<div class="deal-item">ğŸ·ï¸ ${d.title || d} <span class="price" style="float:right">${d.priceCNY ? 'Â¥'+d.priceCNY : ''}</span></div>`;
                });
            } else if (item.roomOffers) {
                item.roomOffers.forEach(r => {
                    html += `<div class="deal-item">ğŸ›ï¸ <b>${r.roomName}</b> <br><span style="color:#999;font-size:0.8rem">${r.breakfast||''} ${r.cancelPolicy||''}</span> <span class="price" style="float:right">Â¥${r.priceCNY}</span></div>`;
                });
            } else {
                html = "<div style='color:#999; padding:10px 0;'>æš‚æ— ç‰¹å®šä¼˜æƒ </div>";
            }
            offersDiv.innerHTML = html;

            // 5. æè¿°æ¸²æŸ“
            const descDiv = document.getElementById('d-desc');
            if(item.amenities) descDiv.innerHTML = "âœ… <b>è®¾æ–½æœåŠ¡ï¼š</b> " + item.amenities.join(' Â· ');
            else if (item.keywords) descDiv.innerHTML = "ğŸ·ï¸ <b>å…³é”®è¯ï¼š</b> " + item.keywords.join('ã€');
            else descDiv.innerText = "æš‚æ— è¯¦ç»†æè¿°";
        });

        // äº¤äº’é€»è¾‘ï¼šæ¨¡æ€æ¡†å¼€å…³
        function openModal() {
            const src = document.getElementById('d-img').src;
            // é˜²æ­¢ç‚¹å‡»å ä½å›¾ä¹Ÿæ”¾å¤§
            if(src.includes('placeholder.com')) return; 
            
            const modal = document.getElementById('imgModal');
            const modalImg = document.getElementById("img01");
            modal.style.display = "block";
            modalImg.src = src;
        }

        function closeModal() {
            document.getElementById('imgModal').style.display = "none";
        }
    </script>
</body>
</html>